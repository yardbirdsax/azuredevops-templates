parameters:
  - name: sourcePath
    type: string
    default: "./"
  - name: archiveFileName
    type: string
  - name: awsCredentialName
    type: string
  - name: awsRegionName
    type: string
    default: us-east-2
  - name: s3BucketName
    type: string
  - name: s3BucketPath
    type: string
    default: ""
steps:
  - task: ArchiveFiles@1
    displayName: Zip Files
    inputs:
      rootFolder: ${{ parameters.sourcePath }}
      archiveFile: ${{ parameters.archiveFileName }}
      archiveType: zip
  - task: AWSCLI@1
    displayName: 'Copy file to ${{ parameters.s3BucketName }} S3 bucket'
    inputs:
      awsCredentials: ${{ parameters.awsCredentialName }}
      regionName: ${{ parameters.awsRegionName }}
      awsCommand: s3
      awsSubCommand: cp
      awsArguments: '${{ parameters.archiveFileName }} s3://${{ parameters.s3BucketName }}/${{ parameters.s3BucketPath }}${{ parameters.archiveFileName }}'
      failOnStandardError: false